name: Update Badge Query String

on:
  schedule:
    - cron: '0 */12 * * *'  # Runs every 12 hours
  workflow_dispatch:  # Allows manual trigger

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout the repository
      uses: actions/checkout@v2
      
    - name: Update README.md
      run: |
        # Print the current UNIX timestamp for diagnostic purposes
        echo "Current UNIX timestamp: $(date +%s)"
        # Generate a unique query string using the current UNIX timestamp
        UNIQUE_STRING=$(date +%s)
        # Correctly update the README.md file with the new query string for the badge URL
        sed -i "s/Robinzor.png\?version=[0-9]*/Robinzor.png?version=${UNIQUE_STRING}/" README.md
        # Print the modified README contents to verify the sed operation
        echo "Modified README.md contents:"
        cat README.md
        
    - name: Commit and push if changes are detected
      run: |
        git config --global user.name 'GitHub Action'
        git config --global user.email 'action@github.com'
        git add README.md
        git diff-index --quiet HEAD || git commit -m "Automatically update badge query string"
        git push
